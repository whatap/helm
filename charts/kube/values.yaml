whatap:
  license: # <license-key>
  host: # <whatap-server-host>
  port: # <whatap-server-port>
  createSecret: true
  existingSecretName: ""

hostNetworkEnabled: false
# whatapResourceAlreadyExist: false
# istioEnabled default
#istioEnabled: false

# k8sOldVersion default
#k8sOldVersion: true

# log
logsink_enabled: false
log_filter_enabled: false
log_filter_allow_list: ""
log_filter_deny_list: ""

# collect_apiserver_metric_by_leader default
collect_apiserver_metric_by_leader: false
collect_custom_resources: false
collect_custom_resources_interval: 300000
addon:
  npm:
    enabled: false
  gpu:
    enabled: false
    image: public.ecr.aws/whatap/dcgm-exporter:4.4.2-4.7.06-ubuntu22.04
  apiserver_monitoring:
    enabled: false # Set to true to use apiserver_monitoring_dashboard(default false)
    client_tls_verify: true # Set to false to skip insecure-tls-verify(default true)
  etcd_monitoring:
    enabled: false # Set to true to use apiserver_monitoring_dashboard(default false)
    # Set path to use customized path
    # minikube: /var/lib/minikube/certs/etcd
    etcd_ca_cert_path: /etc/kubernetes/pki/etcd/ca.crt
    etcd_client_cert_path: /etc/kubernetes/pki/etcd/server.crt
    etcd_client_key_path: /etc/kubernetes/pki/etcd/server.key
imagePullSecret:
  name: #registryKey
containerRuntime: #"docker" # Options: "docker", "containerd", "crio"

#whatap-node-agent
daemonSet:
  enabled: true
  name: whatap-node-agent
  label: whatap-node-agent
  tolerations:
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
  affinity: {}
  initContainers:
    nodeDebugger:
      enabled: true  # Set to false to disable the whatap-node-debug initContainer
      name: whatap-node-debug
      image: "whatap/kube_mon:1.8.9"
  containers:
    nodeHelper:
      name: whatap-node-helper
      image: "whatap/kube_mon:1.8.9"
      requests:
        memory: "100Mi"
        cpu: "100m"
      limits:
        memory: "350Mi"
        cpu: "200m"
      envs:
        collect_nfs_disk_enabled: true
        collect_kube_node_process_metric_enabled: false
        collect_kube_node_process_metric_target_list: "kubelet,containerd,dockerd,crio,coredns,kube-proxy,aws-k8s-agent,kube-apiserver,etcd,kube-controller,kube-scheduler"
        debug: false
    nodeAgent:
      name: whatap-node-agent
      image: "whatap/kube_mon:1.8.9"
      requests:
        memory: "300Mi"
        cpu: "100m"
      limits:
        memory: "350Mi"
        cpu: "200m"
      envs:
        gpu_enabled: false
        log_parser_containerd_std_enabled: false
        collect_kube_node_process_metric_enabled: false
        debug: false
        count_interval: 5000

#whatap-master-agent
deployment:
  enabled: true
  name: whatap-master-agent
  label: whatap-master-agent
  replicas: 1
  tolerations:
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
  affinity: {}
  containers:
    controlPlaneHelper:
      enabled: true  # Set to false to disable the whatap-control-plane-helper container
      debug: false
      name: whatap-control-plane-helper
      image: "whatap/kube_mon:1.8.9"
      port: 9496
      resources:
        requests:
          memory: "500Mi"
          cpu: "500m"
        limits:
          memory: "500Mi"
          cpu: "500m"
    masterAgent:
      name: whatap-master-agent
      image: "whatap/kube_mon:1.8.9"
      port: 6600
      resources:
        requests:
          memory: "300Mi"
          cpu: "100m"
        limits:
          memory: "350Mi"
          cpu: "200m"
      envs:
        collect_workload: false
        collect_deployment: false
        debug: false

#whatap-open-agent
deploymentOpen:
  enabled: false
  name: whatap-open-agent
  label: whatap-open-agent
  replicas: 1
  tolerations:
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
    - key: node-role.kubernetes.io/control-plane
      effect: NoSchedule
  affinity: {}
  containers:
    openAgent:
      name: whatap-open-agent
      image: "public.ecr.aws/whatap/open_agent:1.5.1"
      resources:
        requests:
          memory: "300Mi"
          cpu: "100m"
        limits:
          memory: "1000Mi"
          cpu: "1000m"
      envs:
        debug: false
  config:
    # CR format configuration for whatap-open-agent
    features:
      openAgent:
        enabled: false
        globalInterval: "60s"
        globalPath: "/metrics"
        targets:
          - targetName: "kube-apiserver"
            type: "ServiceMonitor"
            enabled: true
            namespaceSelector:
              matchNames:
                - "default"
              matchLabels: {}
              matchExpressions: []
            selector:
              matchLabels:
                component: "apiserver"
                provider: "kubernetes"
              matchExpressions: []
            endpoints:
              - port: "https"
                path: "/metrics"
                interval: "30s"
                scheme: "https"
                timeout: "30s"
                addNodeLabel: false
                tlsConfig:
                  insecureSkipVerify: true
                  caFile: ""
                  certFile: ""
                  keyFile: ""
                  serverName: ""
                metricRelabelConfigs:
                  - source_labels: [__name__]
                    regex: "apiserver_request_total"
                    action: keep
                  - source_labels: [verb]
                    target_label: http_verb
                    replacement: "${1}"
                    action: replace
                  - target_label: metric_src
                    replacement: "whatap-open-agent"
                    action: replace
          - targetName: "metric-exporter"
            type: "StaticEndpoints"
            enabled: false
            endpoints:
              - address: "192.168.1.100:9100"
                path: "/metrics"
                scheme: "http"
                interval: "60s"
                timeout: "30s"
                metricRelabelConfigs:
                  - source_labels: [__name__]
                    regex: "node_(cpu|memory).*"
                    action: keep
                  - source_labels: [instance]
                    target_label: server
                    replacement: "${1}"
                    action: replace
clusterrole:
  extraResources:
  #- "samplecrds"


# 시나리오 1: 항상 실행 중인 'API 서버' (동적 부하 테스트용)
